(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{440:function(t,a,s){"use strict";s.r(a);var i=s(8),r=Object(i.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_02-intermediate-representation-ir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_02-intermediate-representation-ir"}},[t._v("#")]),t._v(" 02 - Intermediate Representation(IR)")]),t._v(" "),a("blockquote",[a("p",[t._v("本系列笔记的课程地址："),a("a",{attrs:{href:"https://space.bilibili.com/2919428/channel/collectiondetail?sid=342930",target:"_blank",rel:"noopener noreferrer"}},[t._v("南京大学《软件分析》课程2020"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"compilers-and-static-analyzers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compilers-and-static-analyzers"}},[t._v("#")]),t._v(" Compilers and Static Analyzers")]),t._v(" "),a("h4",{attrs:{id:"compiler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compiler"}},[t._v("#")]),t._v(" Compiler")]),t._v(" "),a("p",[a("strong",[t._v("流程：")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("源码 -> (Scanner；进行词法分析；用到 正则表达式) ->")])]),t._v(" "),a("li",[a("p",[t._v("Tokens -> (Parser；进行语法分析；用到 Context-Free Grammar) ->")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Context-Free 上下文无关文法，更适合且足够用于代码")])]),t._v(" "),a("li",[a("p",[t._v("Context-Sensitive 上下文敏感文法，更适合人类语言")])])])]),t._v(" "),a("li",[a("p",[t._v("AST -> (Type Checker；进行语义分析；用到 Attribute Grammar) ->")])]),t._v(" "),a("li",[a("p",[t._v("Decorated AST -> (Translator) ->")])]),t._v(" "),a("li",[a("p",[t._v("IR -> (Code Generator) ->")])]),t._v(" "),a("li",[a("p",[t._v("Machine Code")])])]),t._v(" "),a("p",[t._v("IR 之间是编译器前端，IR 之后是编译器后端")]),t._v(" "),a("p",[t._v("静态分析需要在编译器前端生成的 IR 上进行，例如：代码编译优化 "),a("br")]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922145205484.png",alt:"image-20230922145205484"}}),t._v(" "),a("h3",{attrs:{id:"abstract-syntax-tree-ast-vs-ir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract-syntax-tree-ast-vs-ir"}},[t._v("#")]),t._v(" Abstract Syntax Tree(AST) vs. IR")]),t._v(" "),a("h4",{attrs:{id:"ast"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ast"}},[t._v("#")]),t._v(" AST")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("更接近语法结构；语言相关")])]),t._v(" "),a("li",[a("p",[t._v("适合用来做快速的类型检查")])]),t._v(" "),a("li",[a("p",[t._v("缺少了控制流信息（看不出来控制流）")])])]),t._v(" "),a("h4",{attrs:{id:"ir-三地址码形式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ir-三地址码形式"}},[t._v("#")]),t._v(" IR（三地址码形式）")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("更接近汇编、机器语言；语言无关")])]),t._v(" "),a("li",[a("p",[t._v("紧凑且统一")])]),t._v(" "),a("li",[a("p",[t._v("包含了控制流信息")])]),t._v(" "),a("li",[a("p",[t._v("通常被用来作为静态分析的基础"),a("br")])])]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922150429664.png",alt:"image-20230922150429664"}}),t._v(" "),a("h3",{attrs:{id:"ir-three-address-code-3ac"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ir-three-address-code-3ac"}},[t._v("#")]),t._v(" IR: Three-Address Code(3AC)")]),t._v(" "),a("p",[t._v("3-Address Code(3AC)：一条指令右边最多只有一个运算符")]),t._v(" "),a("p",[t._v("每个三地址码指令包含最多 3 个 addresses")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Address 可以是")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Name：a, b")])]),t._v(" "),a("li",[a("p",[t._v("Constant：3")])]),t._v(" "),a("li",[a("p",[t._v("Compiler-generated temporary：t1，t2")])])])]),t._v(" "),a("li",[a("p",[t._v("eg. "),a("code",[t._v("a + b + 3")]),t._v(" -> "),a("code",[t._v("t1 = a + b; t2 = t1 + 3;")])])])]),t._v(" "),a("p",[t._v("每一种指令都有自己的 3AC Form，下面是一个常见的三地址码："),a("br")]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922152336594.png",alt:"image-20230922152336594"}}),t._v(" "),a("h3",{attrs:{id:"_3ac-in-real-static-analyzer-soot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3ac-in-real-static-analyzer-soot"}},[t._v("#")]),t._v(" 3AC in real Static Analyzer: Soot")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Soot 是 Java 领域非常常用的静态分析框架")])]),t._v(" "),a("li",[a("p",[t._v("Soot 的 IR 是 Jimple（三地址码形式的）")])])]),t._v(" "),a("p",[t._v("下面是一些 Jimple 的例子")]),t._v(" "),a("ol",[a("li",[a("h5",{attrs:{id:"do-while-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#do-while-loop"}},[t._v("#")]),t._v(" Do-While Loop"),a("br")])])]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922153757583.png",alt:"image-20230922153757583"}}),t._v(" "),a("ul",[a("li",[t._v("「$」 标注了临时变量")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("h5",{attrs:{id:"method-call"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#method-call"}},[t._v("#")]),t._v(" Method Call"),a("br")])])]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922160655837.png"}}),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922154215858.png",alt:"image-20230922154215858"}}),t._v(" "),a("ul",[a("li",[a("p",[t._v("JVM 中的四种 invoke 调用")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("invoke speciall：call constructor、call superclass(父类) methods、call private methods")])]),t._v(" "),a("li",[a("p",[t._v("invoke virtual：call instance methods(virtual dispatch，虚函数查表，即会先从调用该方法的对象的类实现中找，找不到再去父类找)")])]),t._v(" "),a("li",[a("p",[t._v("invoke interface：类似 invoke virtual，但不做优化，且会进行 checking interface implementation(实现接口时方法时候都实现了)")])]),t._v(" "),a("li",[a("p",[t._v("invoke static：call static methods")])]),t._v(" "),a("li",[a("p",[t._v("Java 7 还引入了 invoke dynamic")])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("<...>")]),t._v(" 尖括号里的是 method signature：")]),t._v(" "),a("ul",[a("li",[t._v("[class name]: [return type] [method name](parameter type...)")])])])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("h5",{attrs:{id:"class"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#class"}},[t._v("#")]),t._v(" "),a("strong",[t._v("Class")]),a("br")])])]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922161038992.png",alt:"image-20230922161038992"}}),t._v(" "),a("ul",[a("li",[t._v("clinit 是对静态变量的初始化方法")])]),t._v(" "),a("h3",{attrs:{id:"static-single-assignment-ssa-「optional-material」"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#static-single-assignment-ssa-「optional-material」"}},[t._v("#")]),t._v(" Static Single Assignment(SSA) 「optional material」")]),t._v(" "),a("h4",{attrs:{id:"什么是-ssa"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-ssa"}},[t._v("#")]),t._v(" 什么是 SSA ？"),a("br")]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922163112721.png",alt:"image-20230922163112721"}}),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922163140307.png",alt:"image-20230922163140307"}}),t._v(" "),a("ul",[a("li",[t._v("需要记住的两点特征：1. 每个变量都有个准确的定义、名字；2. 当变量名有多种可能性时，会引入 "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.464ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"1.348ex",height:"2.034ex",viewBox:"0 -694 596 899"}},[a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"matrix(1 0 0 -1 0 0)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("path",{attrs:{"data-c":"3D5",d:"M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z"}})])])])])]),t._v(" 来进行合并")],1)]),t._v(" "),a("h4",{attrs:{id:"ssa-的好处-核心点在于变量名的-distinct"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssa-的好处-核心点在于变量名的-distinct"}},[t._v("#")]),t._v(" SSA 的好处（核心点在于变量名的 distinct）")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("程序流可以被间接的融入在 unique variable names 中")]),t._v(" "),a("ul",[a("li",[t._v("携带了更多信息，可以帮助提供一些更简单的分析，例如：flow-insensitive analysis 可以无需提高 cost 就能获取部分 flow-sensitive analysis 的精度")])])]),t._v(" "),a("li",[a("p",[t._v("定义与使用更为清楚、明确")])])]),t._v(" "),a("h4",{attrs:{id:"ssa-的坏处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssa-的坏处"}},[t._v("#")]),t._v(" SSA 的坏处")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("引入更多变量和 "),a("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[a("svg",{staticStyle:{"vertical-align":"-0.464ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"1.348ex",height:"2.034ex",viewBox:"0 -694 596 899"}},[a("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"matrix(1 0 0 -1 0 0)"}},[a("g",{attrs:{"data-mml-node":"math"}},[a("g",{attrs:{"data-mml-node":"mi"}},[a("path",{attrs:{"data-c":"3D5",d:"M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z"}})])])])])]),t._v(" 函数")],1)]),t._v(" "),a("li",[a("p",[t._v("导致一些性能问题"),a("br")])])]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922164425205.png",alt:"image-20230922164425205"}}),t._v(" "),a("h3",{attrs:{id:"control-flow-analysis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#control-flow-analysis"}},[t._v("#")]),t._v(" Control Flow Analysis")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("一般指建立控制流图 Control Flow Graph（CFG)")])]),t._v(" "),a("li",[a("p",[t._v("CFG 是静态分析的基础结构")])]),t._v(" "),a("li",[a("p",[t._v("CFG 中的 node 可以是一个三地址码指令，或者通常是一个 Basic Block")])])]),t._v(" "),a("h4",{attrs:{id:"basic-blocks-bb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#basic-blocks-bb"}},[t._v("#")]),t._v(" Basic Blocks(BB)")]),t._v(" "),a("p",[t._v("BB 是连续三地址码指令的最大序列，且满足 1. 入口唯一(第一条指令)；2. 出口唯一(最后一条指令)")]),t._v(" "),a("p",[t._v("这里的入口和出口指的是一条语句"),a("br")]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922165801637.png",alt:"image-20230922165801637"}}),t._v(" "),a("h5",{attrs:{id:"如何构建-basic-blocks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何构建-basic-blocks"}},[t._v("#")]),t._v(" 如何构建 Basic Blocks？")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("输入：P 的三地址码序列")])]),t._v(" "),a("li",[a("p",[t._v("输出：P 的 BB 列表")])]),t._v(" "),a("li",[a("p",[t._v("算法：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("决定 P 的入口")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("P 的第一条语句一定是入口")])]),t._v(" "),a("li",[a("p",[t._v("跳转命令的 target 指令一定是入口")])]),t._v(" "),a("li",[a("p",[t._v("跳转命令后紧跟的一条语句也一定是入口（因为跳转命令一定是唯一的出口）")])])])]),t._v(" "),a("li",[a("p",[t._v("构建 P 的 BBs")]),t._v(" "),a("ul",[a("li",[t._v("一个 BB 包含了一个入口和直到下一个入口前的所有子序列指令")])])])])]),t._v(" "),a("li",[a("p",[t._v("eg："),a("br")])])]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922171125582.png",alt:"image-20230922171125582"}}),t._v(" "),a("h4",{attrs:{id:"构建-control-flow-graph-cfg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建-control-flow-graph-cfg"}},[t._v("#")]),t._v(" 构建 Control Flow Graph（CFG)")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("CFG 的每个 node 是一个 BB")])]),t._v(" "),a("li",[a("p",[t._v("连接一条 from A to B 的边，需要且仅需要满足下面的条件")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("A 的出口有一个条件跳转或无条件跳转到 B 的入口")])]),t._v(" "),a("li",[a("p",[t._v("B 按指令初始顺序紧跟在 A 的后面，且 A 的出口不是一条无条件跳转（如下图右一为例，"),a("code",[t._v("(j) goto (i)")]),t._v(" 是无跳转指令，A 不能连边到 B）"),a("br")])])])])]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922172101331.png",alt:"image-20230922172101331"}}),t._v(" "),a("ul",[a("li",[t._v("替换指令 label 的跳转为 BB 的跳转"),a("br")])]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922172336482.png",alt:"image-20230922172336482"}}),t._v(" "),a("ul",[a("li",[a("p",[t._v("A 到 B 有一条边，则我们称 A 是 B 的前驱 predecessor，B 是 A 的后继 successor")])]),t._v(" "),a("li",[a("p",[t._v("我们还要添加两个特殊节点，Entry 和 Exit")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("他们与可执行 IR 无关，引入只是为了方便后续静态分析算法设计的初始化")])]),t._v(" "),a("li",[a("p",[t._v("Entry 节点连了一条边到包含了 IR 的第一条指令的 BB（本课程中 Entry 只有一条，例如多线程下可能有多个 Entry）")])]),t._v(" "),a("li",[a("p",[t._v("Exit 节点作为后继，与任何包含了 IR 的最后一条指令的 BB 相连，可能有多条边"),a("br")])])])])]),t._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://yra-typora-image.oss-cn-hangzhou.aliyuncs.com/image-20230922173334570.png",alt:"image-20230922173334570"}}),t._v(" "),a("ul",[a("li",[t._v("【Input：3AC of P】 -> 【Output：CFG of P】")])]),t._v(" "),a("h3",{attrs:{id:"需要掌握的重点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需要掌握的重点"}},[t._v("#")]),t._v(" 需要掌握的重点")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("理解编译器和静态分析的关系")])]),t._v(" "),a("li",[a("p",[t._v("理解 3AC 和他的常见形式（in IR Jimple）")])]),t._v(" "),a("li",[a("p",[t._v("如何在 IR 上构建 Basic Blocks")])]),t._v(" "),a("li",[a("p",[t._v("在 Basic Blocks 上构建控制流图")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);